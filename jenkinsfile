pipeline {
    agent any
    stages {
        stage('Install dependencies - Client') {
            steps {
                script {
                    dir('client') {  // Accéder au répertoire client
                        sh 'npm install'
                    }
                }
            }
        }
        stage('Install dependencies - Server') {
            steps {
                script {
                    dir('server') {  // Accéder au répertoire serveur
                        sh 'npm install'
                    }
                }
            }
        }
        stage('Unit Test - Client') {
            steps {
                script {
                    dir('client') {  // Exécuter les tests dans le répertoire client
                        sh 'npm test'
                    }
                }
            }
        }
        stage('Unit Test - Server') {
            steps {
                script {
                    dir('server') {  // Exécuter les tests dans le répertoire serveur
                        sh 'npm test'
                    }
                }
            }
        }
        stage('Build application - Client') {
            steps {
                script {
                    dir('client') {  // Construire le client
                        sh 'npm run build-dev'
                    }
                }
            }
        }
        stage('Build application - Server') {
            steps {
                script {
                    dir('server') {  // Construire le serveur
                        sh 'npm run build-dev'
                    }
                }
            }
        }
        stage('Start Server') {
            steps {
                script {
                    dir('server/src/config') {  // Accéder au répertoire du serveur
                        sh 'node server.js &'  // Démarrer le serveur en arrière-plan
                    }
                }
            }
        }
        stage('Start Client') {
            steps {
                script {
                    dir('client') {  // Accéder au répertoire client
                        sh 'npm start &'  // Démarrer le client en arrière-plan
                    }
                }
            }
        }
    }
}